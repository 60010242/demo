<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ร้านขายของน้องหมา </title>
<link rel="stylesheet" th:href="@{/CSS/Sfirstpage.css}">
<link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@300;400&display=swap" rel="stylesheet">
<style>
.cathead{
	width: 100%;
	font-size: 15px;
	font-weight: bold;
	text-align: center;
	margin-bottom: 20px;
}
catname{
	font-size: 20px;
	font-weight: bold;
}

a.catdelete img{
	margin-left: 10px;
	width: 14px;
	height: 14px;
}
a.catdelete img:hover{
	font-weight: bolder;
	filter: grayscale(100%);
}
.detailcat{
	width: 80%;
	height: 50px;
	margin: 0 10%;
	color: var(--grey);
	resize: none;
}
.img-cat-container{
	margin-top: 20px;
	flex-flow: column;
}

.product-container{
	padding: 0 10%;
	flex-flow: wrap;
	display: flex;
}
.product-container product{
  	margin: 0;
	width: 33.33333%;
	height: 220px;
}
product div{
	width: 100pt;
	display: inline-table;
	position: relative;
	color: var(--grey);
}
product a{
	color: var(--brown);
	text-decoration: none;
	font-weight: bold;
	font-style: italic;
	cursor: pointer;
}
product .smlxl span{
	width: 48pt;
	display: inline-table;
	position: relative;
}
.addproduct{
	cursor: pointer;
	filter: invert(85%) sepia(3%) saturate(5021%) hue-rotate(342deg) brightness(89%) contrast(78%);
}
.removeproduct{
	position: absolute;
	top: 2%;
	right: 2%;
	filter: invert(18%) sepia(92%) saturate(7486%) hue-rotate(359deg) brightness(106%) contrast(109%);
}

.tablecat-whitebg{
	padding: 5% 0;
	width: 85%;
	float: right;
	border: 0;
	background-color: rgba(255,255,255,60%);
}
.imgproduct{
	width: 100pt;
	height: 100pt;
	border-radius: 100pt;
}

.btnsubmit{
font-family: 'Bai Jamjuree', sans-serif;
	background-color: var(--green);
	height: 20pt;
	width: 50pt;
	border-radius: 5pt;
	text-align: center;
	color: white;
	border: none;
	margin-right: 10%;
	float: right;
	cursor: pointer;
}
.btnsubmit:hover{
	background-color: darkgreen;
	width: 50pt;
	height: 20pt;
	line-height: 20pt;
	font-weight: bolder;
	border: outset 1pt white;
}
.sep>td{
	padding: 5%;
}
</style>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript">

$(document).ready(function(){
	var idcat = document.getElementById("idcat").value;
	var tabcats = document.getElementsByClassName("tabcat");
	var tablinks = document.getElementsByClassName("tablinks");
	
	console.log($('.tabcat-container tr:nth-child(1) a').text());
	
	$('a.tablinks:nth-child(1)').addClass("active");
	for (i = 0; i < tabcats.length; i++) {
	    if(tabcats[i].id == idcat){
	    	$('.tabcat-container tr:nth-child('+(i+1)+') a').addClass("active");
	    	console.log($('.tabcat-container tr:nth-child('+(i+1)+') a').text());
	    }
	  }
	
	$.ajax({url: "/addoneproduct/"+document.getElementById("idcat").value, success: function(result){
	      $("#addproductpage").html(result);
	}});
	$.ajax({url: "/addcategory", success: function(result){
	      $("#addcatpage").html(result);
	}});
	
})

//$('.tabcat-container td a').addClass("active");

function onaddproduct() {
	document.getElementById("overlayaddproduct").style.visibility = "visible";
}
function oneditproduct(idproduct) {
	console.log(idproduct);
	
	$.ajax({url: "/editoneproduct/"+idproduct, success: function(result){
	      $("#editproductpage").html(result);
	}});
	
	document.getElementById("overlayeditproduct").style.visibility = "visible";
}
function oncategory() {
	document.getElementById("overlayaddcat").style.visibility = "visible";
}
function off() {
	document.getElementById("overlayaddcat").style.visibility = "hidden";
	document.getElementById("overlayaddproduct").style.visibility = "hidden";
	document.getElementById("overlayeditproduct").style.visibility = "hidden";
}

</script>

</head>

<body>
<!-- overlay -->
<div id="overlayaddproduct" class="overlayaddcat center">
	<div class="checked">
		<div class="overlayheader center">เพิ่มสินค้า</div>
		<div id="addproductpage"></div>
		<close onclick="off()">X</close>
	</div>
</div>

<div id="overlayeditproduct" class="overlayeditcat center">
	<div class="checked">
		<div class="overlayheader center">แก้ไขสินค้า</div>
		<div id="editproductpage"></div>
		<close onclick="off()">X</close>
	</div>
</div>

<div id="overlayaddcat" class="overlayaddcat center">
	<div class="checked">
		<div class="overlayheader center">เพิ่ม Category</div>
		<div id="addcatpage"></div>
		<close onclick="off()">X</close>
	</div>
</div>


<!-- Main Page -->
<div th:replace="Sfirstpage :: navhead"></div>
<div th:replace="Sfirstpage :: tabseller"></div>

<!-- Tab Category -->
<div style="width: 100%;">
<table class="tabcat-container">
	<tr class="center"
		th:each="cat: ${catlist}"
		th:if="${catlist != null}">
		<td>
			<a class="tabcat"
				th:href="@{'/editproduct/' + ${cat.getIdCategory()}}"
				th:value="${cat.getNameCat()}"
				th:text="${cat.getNameCat()}"
				th:id="${cat.getIdCategory()}"
				>
			</a>
			<!-- th:attr="onclick=|openTabCat(event, '${cat.getIdCategory()}')|" -->
		</td>
	</tr>
	<tr class="center">
		<td>
			<a onclick="oncategory()" class="tabcat cataddheader">+addcategory</a>
		</td>
	</tr>
</table>

<table class="tablecat-whitebg">
	<tr class="sep" th:if="${cat != null}">
		<td>
			<div class="cathead">
				สินค้าประเภท <catname th:text="${cat.getNameCat()}"/>
				<a th:href="@{'/deletecategory/' + ${cat.getIdCategory()}}"
					th:data-confirm-delete="|ต้องการลบ Category ${cat.getNameCat()}?|"
  					onclick="if (!confirm(this.getAttribute('data-confirm-delete'))) return false"
  					class="catdelete"><img th:src="@{/Icon/redtrash.png}"></a>
			</div>
			<form action="#" th:action="@{/updatecat}"
				th:object="${cat}"
				method="post"
				enctype="multipart/form-data">
				
				<div>
				<input id="idcat" type="hidden" th:value="${cat.getIdCategory()}" th:field="*{idCategory}">
				<input id="namecat" type="hidden" th:value="${cat.getNameCat()}" th:field="*{nameCat}">
				<textarea class="detailcat" th:value="${cat.getDetailCat()}" rows="10" cols="20" th:field="*{detailCat}"></textarea>
				
				<div class="img-cat-container center">
					<img style="width: 80%;" alt="can't download"
					th:src="@{'data:image/jpeg;base64,'+${cat.getPhotoCat()}}"><br>
					<input type="file" accept="image/*" name="imageFile">
				</div>
				</div>
				
				<div>
					<input class="btnsubmit" type="submit" value="Submit" name="button"
					th:data-confirm-submit="|ยืนยันแก้ไขรายละเอียด Category ${cat.getNameCat()}?|"
					onclick="if (!confirm(this.getAttribute('data-confirm-submit'))) return false"></div>
			</form>
		</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>
	<tr class="sep" th:if="${cat != null}">
		<td class="product-container">
			<product class="center">
				<a onclick="onaddproduct()"><img class="imgproduct addproduct" th:src="@{/Icon/addplus.png}"></a>
			</product>
			<product class="center" th:each="product: ${products}">
				<div th:if="${product.getEnable()==1}">
					<p id="idproduct" th:value="${product.getIdProduct()}" hidden="true"></p>
					<a th:attr="onclick=|oneditproduct('${product.getIdProduct()}')|">
						<!-- th:href="@{'/editoneproduct/' + ${product.getIdProduct()}}"> -->
						<img class="imgproduct" src="">
						<!--<img class="imgproduct" style="width=100px;" th:if="${product.getPhotoProduct() == null}" alt="can't download" src="https://scontent.fbkk22-2.fna.fbcdn.net/v/t1.0-9/83968655_1508266912688925_789788986167001088_o.jpg?_nc_cat=106&_nc_sid=09cbfe&_nc_eui2=AeEmS9a7V_5EfIh3isYQehQUdnXS_5a1mcd2ddL_lrWZxwCZekQyIsKnHov1EeLDg-A_dWPuo1Ea4PKB91i3xWso&_nc_ohc=O0b9t4pD7DEAX8oKyDd&_nc_ht=scontent.fbkk22-2.fna&oh=abb0c36270eb66c217b41b3c3c035c2d&oe=5F85E625">
						<img class="imgproduct" style="width=100px;" th:if="${product.getPhotoProduct() != null}" alt="can't download" th:src="@{'data:image/jpeg;base64,'+${product.getPhotoProduct()}}"> -->
					</a>
					<a th:attr="onclick=|oneditproduct('${product.getIdProduct()}')|">
						<span th:text="${product.getNameProduct()}"></span>
					</a>
					<a th:href="@{'/editshowproduct/' + ${product.getIdProduct()} +'/' + ${cat.getIdCategory()}}"
						th:data-confirm-delete="|ต้องการลบสินค้า ${product.getNameProduct()}?|"
  						onclick="if (!confirm(this.getAttribute('data-confirm-delete'))) return false"
  						class="removeproduct">
  						<img style="width: 30px; height: 30px;" th:src="@{/Icon/removeminus.png}">
  						</a><br>
					<div class="smlxl" th:if="${product.getNumberStock() == null}">
						<span th:text="|S&nbsp;&nbsp;&nbsp;&nbsp;${product.getS()}|"></span>
						<span th:text="|M&nbsp;&nbsp;&nbsp;&nbsp;${product.getM()}|"></span><br>
						<span th:text="|L&nbsp;&nbsp;&nbsp;&nbsp;${product.getL()}|"></span>
						<span th:text="|XL&nbsp;&nbsp;&nbsp;${product.getXl()}|"></span><br>
					</div>
					<div th:if="${product.getNumberStock() != null}">
						<span th:text="|จำนวน&nbsp;&nbsp;&nbsp;&nbsp;${product.getNumberStock()}|"></span><br>
					</div>
				</div>
			</product>
		</td>
	</tr>

</table>
</div>
</body>
</html>